---
layout: page
title: "Q126642: SMS: Troubleshooting Inventory Collection Problems"
permalink: kb/126/Q126642/
---

## Q126642: SMS: Troubleshooting Inventory Collection Problems

	Article: Q126642
	Product(s): Microsoft Systems Management Server
	Version(s): winnt:1.0,1.1
	Operating System(s): 
	Keyword(s): kbInventory kbMaintMan kbsmsAdmin smsadmin smsinv smshowto smsmaintman
	Last Modified: 31-JUL-2001
	
	-------------------------------------------------------------------------------
	The information in this article applies to:
	
	- Microsoft Systems Management Server versions 1.0, 1.1 
	-------------------------------------------------------------------------------
	
	SUMMARY
	=======
	
	This article describes several Systems Management Server inventory collection
	problems, and what you can do to resolve them.
	
	MORE INFORMATION
	================
	
	The Client Stops Responding When You Run Inventory Agent
	--------------------------------------------------------
	
	1. See if you have a Smssafe.tmp file. This file lists each test that was run.
	  The last test listed indicates which test caused the client to stop
	  responding. Inventory Agent deletes this file if it completes normally.
	
	  NOTE: If you are running Systems Management Server 1.1, the Smssafe.tmp file
	  is located in the Ms\Sms\Data directory.
	
	2. Set the SMSLS=1 environment variable. This variable enables the Smsls.bat
	  file's verbose mode, to help you determine where the Inventory Agent caused
	  the client to stop responding. verbose mode echoes all output to the screen.
	
	3. Once you determine where the Inventory Agent is stopping, remove or
	  reconfigure the suspect component and run the inventory again. Once the
	  problem has been narrowed down to a particular configuration, report the
	  results to Microsoft Technical Support.
	
	You Run Inventory Agent on a New Client but the Inventory Doesn't Appear in the Database
	----------------------------------------------------------------------------------------
	
	1. Look at the CurrentLogonServer entry in the hidden Sms.ini file, to determine
	  what logon server Systems Management Server is reporting the inventory to.
	
	2. For MS-DOS, Windows, Windows for Workgroups, and Windows NT clients, check
	  the \\<logon server>\Sms_Shr\Inventry.box directory for a .raw file
	  generated by the client. For Macintosh and OS/2 clients, check the
	  \\<logon server>\Sms_Shr\Isvmif.box directory for a .mif file. If
	  multiple files exist, look for one with a recent time stamp. Display the text
	  contents of the file, and look for a Systems Management Server ID that
	  matches the Systems Management Server Unique ID entry in the Sms.ini file.
	  Confirm that the Inventory Agent did write this file.
	
	  NOTE: The .raw file has a binary header and a text detail area. The .mif file
	  is a text file. A first-time .mif file is about 40-60K in size. Delta .mif
	  files are usually less than 5K in size.
	
	3. If the .raw or .mif file does not exist, check for a permission or connection
	  problem. The client's Inventory Agent may not be able to connect and write to
	  this location.
	
	  If this file does exist, then Inventory Agent is working properly. See the
	  next section to determine if one of the Systems Management Server Site
	  services is suspect.
	
	Inventory Agent Runs Normally on the
	Client but the Hardware Inventory Is Not Updated
	-------------------------------------------------------------------------------------
	
	1. Confirm that the hardware inventory collection interval has expired for the
	  client. Check the current LastHardwareScan value in the Sms.ini file, add the
	  inventory collection interval configured for the Systems Management Server
	  site, and compare the resulting date against the client's current system
	  clock date. Systems Management Server uses this procedure to determine when
	  it needs to collect hardware or software inventory.
	
	  For more information on the inventory process, see Appendix C of the "Systems
	  Management Server Administrator's Guide version 1.1" or chapter 3 of the
	  "Systems Management Server Resource Guide."
	
	2. The Systems Management Server Maintenance Manager service is responsible for
	  collecting the .raw and .mif files from the logon servers, and transferring
	  them to the Systems Management Server Site server. These files are placed in
	  the \Sms\Site.srv\Inventry.box or Isvmif.box directory, depending on the
	  client type. If the files do not arrive during the Maintenance Manager
	  watchdog cycle, check the Sms\Logs\Maintman.log file for errors that occurred
	  while either attempting to connect to the logon server or transferring files
	  to the site server.
	
	3. After these files reach the site server, the Systems Management Server
	  Inventory Data Processor service processes them and places the output in the
	  Sms\Site.srv\Dataload.box\Deltamif.col directory. If the files are not
	  removed from the source directories, or do not appear in the destination
	  directory, check the Sms\Logs\Invproc.log file for errors.
	
	4. After the output is written to the ...\Deltamif.col directory, the Systems
	  Management Server Inventory Data Loader copies the data in these files to the
	  SQL database. If the files are not removed from this directory, or the data
	  does not appear in the SQL database, check the Sms\Logs\Datalodr.log file for
	  errors.
	
	5. Use the Systems Management Server Services Manager to stop the services while
	  you troubleshoot this problem. After you examine a file at one point in the
	  process, start the service that will process that file. This allows you (the
	  administrator) time to look at the file before it is deleted, and the results
	  are sent to the next point in the system.
	
	6. Log file entries report both the Systems Management Server event ID and the
	  Windows NT error code. Convert the Windows NT error code to text, using
	  Error32, to determine what the actual error is.
	
	  Error32 can be copied from the Psstools directory on the Systems Management
	  Server compact disc.
	
	Inventory in the Database Is Corrupt or Incorrect
	-------------------------------------------------
	
	1. Run Inventory Agent on the client and check the .raw or .mif file (at the
	  locations mentioned above) generated by the client. Compare the inventory
	  reported with the known configuration of the client. If the .raw or .mif file
	  is correct on the logon server, check the file again after it is moved to the
	  site server, and once again after the Systems Management Server Inventory
	  Processor has created the delta .mif in the ...\Deltamif.col directory.
	
	2. If corruption occurs in the .raw or .mif file on the logon server, it is
	  usually caused by the Inventory Agent. If this happens, enable the Inventory
	  Agent verbose mode, and watch the output, to determine where the problem
	  occurs.
	
	3. If the .raw or .mif files on the Systems Management Server Site server are
	  corrupted, check the associated service log files for error or warning
	  messages. These messages may indicate network or file system problems that
	  are causing the corruption. The Systems Management Server Data Loader service
	  does not usually parse the .mif file or put the file in the
	  Datalodr.box\badmifs directory for the administrator to review.
	
	Software Inventory Is Not Collected or Updated
	----------------------------------------------
	
	1. Confirm that the software inventory collection interval has expired. Use the
	  same procedure as above ("Inventory Agent Runs Normally on the Client but the
	  Hardware Inventory Is Not Updated," step one), but use the value in
	  LastSoftwareScan to confirm the software collection interval.
	
	2. Confirm that a compiled software package rules file (Pkg_16.cfg) exists on
	  the logon servers. This file specifies what software inventory is supposed to
	  be collected from the Systems Management Server client by Inventory Agent.
	  Check Appendix C of the "Systems Management Server Administrator's Guide" for
	  details on how Pkg_16.cfg is created and placed on the logon servers.
	
	3. Check the Package.rul file and confirm that it has the proper software
	  package rules. This file is compiled to create the Pkg_16.cfg file. Refer to
	  Appendix C for the location.
	
	4. Check the resulting .raw or .mif file created by the Inventory Agent.
	  Software inventory and collected files are appended to the end of the
	  hardware inventory section.
	
	5. Carefully check your Software Package inventory rule properties (created
	  using Systems Management Server Administrator). Many software inventory
	  problems occur due to a bad rules configuration.
	
	Machine Inventory Appears to Change and Contains Entries from Another System
	----------------------------------------------------------------------------
	
	This problem usually occurs when two clients have mistakenly been configured with
	the same Systems Management Server ID. Check the machine name, logon name, or
	other unique identifier. If any of these items change, you should be able to
	track down which computers have the same Systems Management Server ID.
	
	To correct this problem, delete the Sms.ini file from one of the systems and run
	Smsls.bat again on that system. This process assigns a new Systems Management
	Server ID to the affected system, and creates a new entry in the SQL database.
	If this problem occurs on several systems, check all the \\<logon
	server>\Sms_shr\Smsid directories for the site, and confirm that the current
	.uid file contains a unique ID to be assigned to the next new Systems Management
	Server client configured by the system.
	
	Additional query words:
	
	======================================================================
	Keywords          : kbInventory kbMaintMan kbsmsAdmin smsadmin smsinv smshowto smsmaintman 
	Technology        : kbSMSSearch kbSMS100 kbSMS110
	Version           : winnt:1.0,1.1
	
	=============================================================================
	
