DOCUMENT:Q231275  06-AUG-2002  [exchange]
TITLE   :XCON: MTA in Uncontrollable State; MTA Service Can't Be Stopped
PRODUCT :Microsoft Exchange
PROD/VER:winnt:4.0,5.0,5.5
OPER/SYS:
KEYWORDS:exc4 exc5 exc55

======================================================================
-------------------------------------------------------------------------------
The information in this article applies to:

 - Microsoft Exchange Server, versions 4.0, 5.0, 5.5 
-------------------------------------------------------------------------------

SYMPTOMS
========

It is possible that the message transfer agent (MTA) may enter an uncontrollable
state. In some instances, it cannot be stopped with the interface in the Control
Panel, Services tool. This may be caused by a corrupted message entering the MTA
database for processing or by a corruption within the MTA database itself.
Another possible cause is an excessively large message entering the server from
the Internet. Messages are not processed by the MTA while it is in this state,
and they queue up in their respective queues.

RESOLUTION
==========

While the MTA is in this uncontrollable state and cannot be stopped through
normal procedures, the Exchange Server Administrator program itself may not be
accessible. In fact, when you try to access the Administrator program, you may
see a Busy icon. Furthermore, if you try to stop the System Attendant service,
it may also be in an uncontrollable state.

To resolve this issue:

1. Try to stop the MTA through the Control Panel, Services tool. Give it enough
   time (five minutes at least) to make sure the service has actually stopped
   responding. If it does not stop gracefully, proceed with the next step.

2. Use the Windows NT Task Manager, and on the Processes tab, find the EMSMTA
   process. Try to end the process by clicking the End Process button at the
   bottom right corner. Make sure you are logged on using the Exchange Site
   service account while performing this step.

3. Note the process ID for the EMSMTA process from the Processes tab in the PID
   column. Use the Kill.exe utility to kill the MTA at this point. The Kill.exe
   utility can be found on the Windows NT Resource Kit CD. From a command prompt
   type:

   "Kill <Process ID found in task manager's PID column>" (without the
   quotation marks)

-or-

   "Kill emsmta" (without the quotation marks)

4. After the MTA is stopped or killed, run Mtacheck.exe twice. Mtacheck may find
   corrupted messages or queues. If it does, run it again until it says
   "Database clean. No errors detected." For additional information on running
   Mtacheck, please see the following articles in the Microsoft Knowledge Base:

   Q148284 XCON: When and How to use the Mtacheck Utility

   Q149017 XCON: MTACheck Event IDs and Command Line Syntax

   Q163326 XCON: How and Why to Run Mtacheck

5. Re-start the MTA. The service should start and begin processing mail.
   Processing the backlog may be slow depending on the size of the queue.

If there are several thousand messages, it may be helpful to run Mtacheck with
the /rd switch. This takes some of the processing load from the MTA. The deleted
directory replication messages are regenerated by the Directory service.

NOTE: The MTA may not start if there is some higher-level corruption within the
MTA database or any other severe problems with the MTA. If this is the case,
please contact Microsoft Product Support Services.

Additional query words:

======================================================================
Keywords          : exc4 exc5 exc55 
Technology        : kbExchangeSearch kbExchange500 kbExchange550 kbExchange400 kbZNotKeyword2
Version           : winnt:4.0,5.0,5.5
Issue type        : kbprb

=============================================================================

THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.

Copyright Microsoft Corporation 2002.