DOCUMENT:Q266433  15-MAY-2002  [winnt]
TITLE   :MS00-070: Patch for Numerous Vulnerabilities in the LPC Port Sys
PRODUCT :Microsoft Windows NT
PROD/VER::2000,4.0
OPER/SYS:
KEYWORDS:kbSecurity kbfix w2000ipsec kbWinNT400PreSP7Fix kbWin2000PreSP2Fix kbWin2000SP2Fix kbIP

======================================================================
-------------------------------------------------------------------------------
The information in this article applies to:

 - Microsoft Windows NT Server version 4.0 
 - Microsoft Windows NT Workstation version 4.0 
 - Microsoft Windows NT Server version 4.0, Terminal Server Edition 
 - Microsoft Windows NT Server, Enterprise Edition version 4.0 
 - Microsoft Windows 2000 Professional 
 - Microsoft Windows 2000 Server 
 - Microsoft Windows 2000 Advanced Server 
 - Microsoft Windows 2000 Datacenter Server 
-------------------------------------------------------------------------------

SYMPTOMS
========

Microsoft has released a patch that addresses a range of vulnerabilities in
local procedure call (LPC) functionality and LPC ports. These vulnerabilities
include:

 - Invalid LPC request - This vulnerability affects only Windows NT 4.0-based
   computers. By levying an invalid LPC request, the affected computer may not
   work.

 - LPC memory exhaustion - This vulnerability affects both Windows NT 4.0-based
   computers and Windows 2000-based computers. When malicious LPC requests are
   sent, the number of queued LPC messages may increase and kernel memory may be
   depleted.

 - Predictable LPC message identifier - This vulnerability affects both Windows
   NT 4.0-based computers and Windows 2000-based computers. Any process that is
   aware of the identifier of an LPC message can access it, however, the
   identifiers can be predicted. In the simplest case, a malicious user can
   access other processed LPC ports and send them random data as a denial of
   service attack. In the worst case, the malicious user may be able to send
   spurious requests to a privileged process to receive additional local
   privileges.

 - Spoofed LPC port request - This is a new variant of the previously reported
   "spoofed LPC port request" vulnerability. This vulnerability affects both
   Windows NT 4.0-based computers and Windows 2000-based computers, and can,
   under very restricted conditions, allow a malicious user to create a process
   that runs under the security context of an already-running process, which may
   include system processes.

NOTE: Because you can use LPC only on the local computer, none of these
vulnerabilities can be exploited remotely. Instead, a malicious user can exploit
these vulnerabilities only on a computer that the malicious user can log on to
interactively. Typically, workstations and terminal server computers are at risk
because, if normal security practices are followed, users are not allowed to log
on to critical servers interactively. This also means that, even in the worst
case, the malicious user can get only additional local privileges and not domain
privileges.

RESOLUTION
==========

To resolve this problem, obtain the latest service pack for Windows 2000. For
additional information, please see the following article in the Microsoft
Knowledge Base:

   Q260910 How to Obtain the Latest Windows 2000 Service Pack

Windows 2000
------------

The following files are available for download from the Microsoft Download
Center:

   DownloadDownload Q266433_w2k_sp2_x86_en.exe now
   (http://www.microsoft.com/Downloads/Release.asp?ReleaseID=24649)

For additional information about how to download Microsoft Support files, click
the article number below to view the article in the Microsoft Knowledge Base:

   Q119591 How to Obtain Microsoft Support Files from Online Services

Microsoft used the most current virus detection software available on the date of
posting to scan this file for viruses. After it is posted, the file is housed on
secure servers that prevent any unauthorized changes to the file.

After applying the hotfix, the Windows 2000 System properties show the system as
"Service Pack 1, RC 1.1." This version stamp does not cause any problems. It is
simply the version that was coded into the patch.


The English-language version of this fix should have the following file
attributes or later:

   Date    Time    Version        Size       File name
   ------------------------------------------------------
   7/6/00  1:46pm  5.0.2195.2099  1,659,328  Ntoskrnl.exe
   7/6/00  1:46pm  5.0.2195.2099  1,681,536  Ntkrnlmp.exe

NOTE: The Ntkrnlmp.exe file is used only on computers with multiple processors.


Windows NT 4.0
--------------

To resolve this problem, obtain the individual package referenced below or obtain
the Windows NT 4.0 Security Rollup Package. For additional information on the
SRP, click the article number below to view the article in the Microsoft
Knowledge Base:

   Q299444 Post-Windows NT 4.0 Service Pack 6a Security Rollup Package (SRP)

   DownloadDownload 266433i.exe now
   (http://www.microsoft.com/Downloads/Release.asp?ReleaseID=24650)

The English-language version of this fix should have the following file
attributes or later:

   Date    Time    Version        Size       File name
   ------------------------------------------------------
   7/6/00  5:19pm  4.0.1381.7080  934,720   Ntoskrnl.exe
   7/6/00  5:19pm  4.0.1381.7080  955,200   Ntkrnlmp.exe

NOTE: The Ntkrnlmp.exe file is used only on computers with multiple processors.


Windows NT Server 4.0, Terminal Server Edition
----------------------------------------------

To resolve this problem, either obtain the hotfix referenced in this section or
the Windows NT Server 4.0, Terminal Server Edition, Security Rollup Package
(SRP). For additional information about the SRP, click the article number below
to view the article in the Microsoft Knowledge Base:

   Q317636 Windows NT Server 4.0, Terminal Server Edition, Security Rollup
   Package

A supported fix is now available from Microsoft, but it is only intended to
correct the problem described in this article and should be applied only to
systems that are determined to be at risk of attack. Please evaluate your
computer's physical accessibility, network and Internet connectivity, and other
factors to determine the degree of risk to your computer. Please see the
associated Microsoft Security Bulletin
(http://www.microsoft.com/technet/security/bulletin/ms00-070.asp) to help make
this determination. This fix may receive additional testing at a later time, to
further ensure product quality. If your computer is sufficiently at risk,
Microsoft recommends that you apply this fix now.

To resolve this problem immediately, download the fix as instructed below or
contact Microsoft Product Support Services to obtain the fix. For a complete
list of Microsoft Product Support Services phone numbers and information on
support costs, please go to the following address on the World Wide Web:

   http://support.microsoft.com/default.aspx?scid=fh;EN-US;CNTACTMS

NOTE: In special cases, charges that are normally incurred for support calls may
be canceled, if a Microsoft Support Professional determines that a specific
update will resolve your problem. Normal support costs will apply to additional
support questions and issues that do not qualify for the specific update in
question.

The following file is available for download from the Microsoft Download Center:

   DownloadDownload Q266433i.exe now
   (http://www.microsoft.com/Downloads/Release.asp?ReleaseID=32930)

Release Date: October 12, 2001

For additional information about how to download Microsoft Support files, click
the article number below to view the article in the Microsoft Knowledge Base:

   Q119591 How to Obtain Microsoft Support Files from Online Services

Microsoft used the most current virus detection software available on the date of
posting to scan this file for viruses. After it is posted, the file is housed on
secure servers that prevent any unauthorized changes to the file.

NOTE: After you apply this patch, the operating system version changes from Build
1381: Service Pack 6 to Build 1381: Service Pack 6, RC1.6. This change in the
displayed version number does not cause any errors or issues.

The English version of this fix should have the following file attributes or
later:

   Date         Time   Version         Size       File name
   -----------------------------------------------------------
   29-Jan-2001  11:46  4.0.1381.33474  1,003,392  Ntkrnlmp.exe
   29-Jan-2001  11:39                    156,496  Ntldr
   29-Jan-2001  11:46  4.0.1381.33474    982,144  Ntoskrnl.exe

NOTE: Due to file dependencies, this update requires Windows NT Server 4.0,
Terminal Server Edition Service Pack 6.



STATUS
======

Windows 2000
------------

Microsoft has confirmed that this problem could result in some degree of security
vulnerability in Windows 2000. This problem was first corrected in Windows 2000
Service Pack 2.

Windows NT 4.0
--------------

Microsoft has confirmed that this problem could result in some degree of security
vulnerability in Windows NT 4.0.

Windows NT Server 4.0, Terminal Server Edition
----------------------------------------------

Microsoft has confirmed that this problem could result in some degree of security
vulnerability in Windows NT Server 4.0, Terminal Server Edition.

MORE INFORMATION
================

For additional information about this issue, view the following Microsoft Web
site:

   http://www.microsoft.com/technet/security/bulletin/ms00-070.asp

Frequently asked questions about this vulnerability are available on the
following Microsoft Web site:

   http://www.microsoft.com/technet/security/bulletin/fq00-070.asp

Additional query words: use security_patch

======================================================================
Keywords          : kbSecurity kbfix w2000ipsec kbWinNT400PreSP7Fix kbWin2000PreSP2Fix kbWin2000SP2Fix kbIPSec KbSECVulnerability KbSECBulletin 
Technology        : kbWinNTsearch kbWinNTWsearch kbWinNTW400 kbWinNTW400search kbWinNT400search kbwin2000AdvServ kbwin2000AdvServSearch kbwin2000DataServ kbwin2000DataServSearch kbwin2000Serv kbWinNTSsearch kbWinNTSEntSearch kbWinNTSEnt400 kbWinNTS400search kbWinNTS400 kbwin2000ServSearch kbwin2000Search kbwin2000ProSearch kbwin2000Pro kbNTTermServ400 kbNTTermServSearch kbWinAdvServSearch kbWinDataServSearch
Version           : :2000,4.0
Issue type        : kbbug
Solution Type     : kbfix

=============================================================================

THE INFORMATION PROVIDED IN THE MICROSOFT KNOWLEDGE BASE IS
PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND.  MICROSOFT DISCLAIMS
ALL WARRANTIES, EITHER EXPRESS OR IMPLIED, INCLUDING THE WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO
EVENT SHALL MICROSOFT CORPORATION OR ITS SUPPLIERS BE LIABLE FOR
ANY DAMAGES WHATSOEVER INCLUDING DIRECT, INDIRECT, INCIDENTAL,
CONSEQUENTIAL, LOSS OF BUSINESS PROFITS OR SPECIAL DAMAGES, EVEN IF
MICROSOFT CORPORATION OR ITS SUPPLIERS HAVE BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.  SOME STATES DO NOT ALLOW THE EXCLUSION
OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES
SO THE FOREGOING LIMITATION MAY NOT APPLY.

Copyright Microsoft Corporation 2002.